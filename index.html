<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amazon Affiliate Deal Automation</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #74EBD5, #ACB6E5);
        color: #333;
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .container {
        background: #fff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 600px;
        text-align: center;
        transition: 0.3s;
    }
    .container:hover {
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }
    button, input {
        width: 100%;
        padding: 15px;
        margin: 10px 0;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
    }
    button {
        background: #4CAF50;
        color: #fff;
    }
    button:hover {
        background: #45a049;
    }
    input {
        background: #f1f1f1;
    }
    .output {
        background: #f1f1f1;
        padding: 15px;
        border-radius: 6px;
        margin-top: 20px;
        word-break: break-word;
        position: relative;
    }
    .channel-list {
        margin: 10px 0;
    }
    .channel-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f1f1f1;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 5px;
    }
    .remove-btn {
        background: #ff4d4d;
        color: #fff;
        border: none;
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 4px;
    }
    .remove-btn:hover {
        background: #ff1a1a;
    }
</style>
</head>
<body>
<div class="container">
    <h2>Amazon Deal Auto-Converter with Bitly & Multi-Channel Support</h2>
    <input type="text" id="tagInput" placeholder="Enter Affiliate Tag" value="yourtag-21">
    <button onclick="saveTag()">Save Tag</button>
    <input type="text" id="bitlyToken" placeholder="Enter Bitly Token">
    <button onclick="saveBitlyToken()">Save Bitly Token</button>
    
    <h3>Manage Destination Channels</h3>
    <input type="text" id="channelInput" placeholder="Add Destination Channel (@username)">
    <button onclick="addChannel()">Add Channel</button>
    <div id="channelList" class="channel-list"></div>
    <button onclick="saveChannels()">Save Channels</button>
    
    <input type="text" id="manualLink" placeholder="Paste Amazon link here">
    <button onclick="convertAndShareManual()">Convert & Share Manually</button>
    <div id="status" class="output">Waiting for deals...</div>
</div>

<script>
const botToken = '8183233922:AAGBW7OXp0LPnfmP5zeyUMjNF7xORz6l5QI';
let affiliateTag = localStorage.getItem('affiliateTag') || 'yourtag-21';
let bitlyToken = localStorage.getItem('bitlyToken') || '';
let destinationChannels = JSON.parse(localStorage.getItem('destinationChannels')) || [];

document.getElementById('tagInput').value = affiliateTag;
document.getElementById('bitlyToken').value = bitlyToken;
renderChannelList();

function saveTag() {
    const newTag = document.getElementById('tagInput').value.trim();
    if (newTag) {
        localStorage.setItem('affiliateTag', newTag);
        affiliateTag = newTag;
        alert('Affiliate tag saved successfully!');
    }
}

function saveBitlyToken() {
    const newToken = document.getElementById('bitlyToken').value.trim();
    if (newToken) {
        localStorage.setItem('bitlyToken', newToken);
        bitlyToken = newToken;
        alert('Bitly token saved successfully!');
    }
}

function addChannel() {
    const channelInput = document.getElementById('channelInput').value.trim();
    if (!/^@[a-zA-Z0-9_]{5,}$/.test(channelInput)) {
        alert('Invalid channel format. Use @username with at least 5 characters.');
        return;
    }
    if (destinationChannels.length >= 5) {
        alert('You can only add up to 5 channels.');
        return;
    }
    if (!destinationChannels.includes(channelInput)) {
        destinationChannels.push(channelInput);
        renderChannelList();
    }
}

function renderChannelList() {
    const listElement = document.getElementById('channelList');
    listElement.innerHTML = '';
    destinationChannels.forEach((channel, index) => {
        const item = document.createElement('div');
        item.className = 'channel-item';
        item.innerHTML = `
            <span>${channel}</span>
            <button class="remove-btn" onclick="removeChannel(${index})">Remove</button>
        `;
        listElement.appendChild(item);
    });
}

function removeChannel(index) {
    destinationChannels.splice(index, 1);
    renderChannelList();
}

function saveChannels() {
    localStorage.setItem('destinationChannels', JSON.stringify(destinationChannels));
    alert('Channels saved successfully!');
}

async function convertAndShareManual() {
    let inputLink = document.getElementById('manualLink').value.trim();
    if (!inputLink) {
        alert('Please enter a valid Amazon link.');
        return;
    }
    try {
        const url = new URL(inputLink);
        url.searchParams.set('tag', affiliateTag);
        const convertedLink = url.toString();
        
        if (bitlyToken) {
            const shortenedLink = await shortenWithBitly(convertedLink);
            await shareToChannels(shortenedLink || convertedLink);
        } else {
            await shareToChannels(convertedLink);
        }
        
        document.getElementById('status').textContent = 'Manual link shared successfully!';
    } catch (error) {
        console.error('Invalid URL:', error);
        document.getElementById('status').textContent = 'Failed to convert or share.';
    }
}

async function shortenWithBitly(link) {
    try {
        const response = await fetch('https://api-ssl.bitly.com/v4/shorten', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${bitlyToken}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ long_url: link })
        });
        const data = await response.json();
        return data.link || link;
    } catch (error) {
        console.error('Bitly shortening failed:', error);
        return link;
    }
}

async function shareToChannels(message) {
    for (const channel of destinationChannels) {
        const url = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${channel}&text=${encodeURIComponent(message)}`;
        await fetch(url, { method: 'GET' });
    }
}
</script>
</body>
</html>
